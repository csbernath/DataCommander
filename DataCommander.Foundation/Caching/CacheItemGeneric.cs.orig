namespace DataCommander.Foundation.Caching
{
    using System;

#if FOUNDATION_2_0 || FOUNDATION_3_5
    using DataCommander.Foundation.Diagnostics;
#else
    using System.Diagnostics.Contracts;
#endif


    /// <summary>
    /// 
    /// </summary>
    /// <typeparam name="T"></typeparam>
    public sealed class CacheItem<T> : ICacheItem
    {
        private readonly String key;
        private readonly TimeSpan slidingExpiration;
        private readonly Func<T> getValue;
        private T value;

        internal CacheItem( String key, Func<T> getValue, TimeSpan slidingExpiration )
        {
#if FOUNDATION_2_0 || FOUNDATION_3_5
            Assert.IsNotNull( key, "key" );
            Assert.IsNotNull( getValue, "getValue" );
            Assert.Compare( slidingExpiration, Comparers.GreaterThan, TimeSpan.Zero, "slidingExpiration", "0" );
#else
            Contract.Requires( key != null );
            Contract.Requires( getValue != null );
            Contract.Requires( slidingExpiration > TimeSpan.Zero );
#endif
            this.key = key;
            this.slidingExpiration = slidingExpiration;
            this.getValue = getValue;
        }

        /// <summary>
        /// 
        /// </summary>
        public T Value
        {
            get
            {
                return this.value;
            }
        }

        #region ICacheItem Members

        String ICacheItem.Key
        {
            get
            {
                return this.key;
            }
        }

        TimeSpan ICacheItem.SlidingExpiration
        {
            get
            {
                return this.slidingExpiration;
            }
        }

        Object ICacheItem.GetValue()
        {
            T value = this.getValue();
            this.value = value;
            return value;
        }

        #endregion
    }
}